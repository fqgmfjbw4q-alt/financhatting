{% extends "base.html" %}
{% block title %}KayÄ±t â€¢ Financhatting{% endblock %}

{% block content %}
<div class="page">
  <div class="wrap">
    <div class="card">
      <h1>ðŸ§¾ KayÄ±t Ol</h1>
      <p class="muted">Twitter mantÄ±ÄŸÄ±: username sabit, profil URLâ€™in /@username olur.</p>

      <label class="field">
        <span>Ad Soyad</span>
        <input id="full_name" placeholder="Mustafa Ã‡elik" autocomplete="name" />
      </label>

      <label class="field">
        <span>KullanÄ±cÄ± adÄ±</span>
        <input id="username" placeholder="mustafi42" autocomplete="username" />
        <small>Harf/rakam/._ Ã¶nerilir. BoÅŸluk yok.</small>
      </label>

      <label class="field">
        <span>Åžifre</span>
        <input id="password" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="new-password" />
      </label>

      <div class="actions">
        <button class="btn btn-primary" id="btnRegister">KayÄ±t</button>
        <a class="btn btn-ghost" href="/login">GiriÅŸ</a>
      </div>

      <div id="msg" class="msg" style="display:none;"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
  .page{padding:20px 6px 60px;}
  .wrap{max-width:560px;margin:0 auto;}
  .card{
    background: linear-gradient(145deg,var(--panel) 0%,var(--panel2) 100%);
    border:1px solid var(--border);
    border-radius:16px;
    padding:18px;
  }
  h1{margin:0 0 6px;color:var(--green);text-shadow:0 0 20px rgba(16,185,129,.25);}
  .muted{color:var(--muted);margin:0 0 14px;}
  .field{display:flex;flex-direction:column;gap:8px;margin-bottom:12px;}
  .field span{color:var(--muted);font-weight:900;}
  input{
    border:1px solid var(--border);
    background: rgba(15,23,42,.35);
    color:var(--text);
    border-radius:14px;
    padding:12px 14px;
    outline:none;
    font-family:inherit;
  }
  small{color:var(--muted2);font-size:.9em;}
  .actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-top:10px;}
  .msg{
    margin-top:12px;
    padding:10px 12px;border-radius:12px;
    border:1px solid rgba(239,68,68,.65);
    background: rgba(239,68,68,.12);
    color:#fca5a5;font-weight:900;
  }
</style>
{% endblock %}

{% block extra_js %}
<script>
  async function apiPost(url,payload){
    const r = await fetch(url,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload||{})});
    if(!r.ok) throw new Error(await r.text());
    return await r.json();
  }
  function showMsg(t){
    const m=document.getElementById("msg"); m.textContent=t; m.style.display="block";
  }
  async function register(){
    const full_name=(document.getElementById("full_name").value||"").trim();
    const username=(document.getElementById("username").value||"").trim();
    const password=(document.getElementById("password").value||"").trim();
    if(!full_name||!username||!password) return showMsg("TÃ¼m alanlar gerekli.");
    try{
      document.getElementById("btnRegister").disabled=true;
      // expected: POST /api/auth/register
      await apiPost("/api/auth/register",{full_name,username,password});
      window.location.href="/feed";
    }catch(e){
      showMsg("KayÄ±t baÅŸarÄ±sÄ±z. Username alÄ±nmÄ±ÅŸ olabilir.");
    }finally{
      document.getElementById("btnRegister").disabled=false;
    }
  }
  document.getElementById("btnRegister").onclick=register;
  document.addEventListener("keydown",(e)=>{ if(e.key==="Enter") register(); });
</script>
{% endblock %}